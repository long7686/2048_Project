<<<<<<< Updated upstream
{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/GameManagaer.js"],"names":["ROWS","cc","Class","extends","Component","properties","scoreLabel","Label","bestScoreLabel","blockPrefab","Prefab","bgBox","Node","cellPrefab","loseLayOut","winLayOut","_gap","default","serializable","_blockSize","_data","_arrBlock","_posisions","_score","_canMove","onLoad","active","start","width","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","blockInit","init","arrInit","x","y","blockArr","Array","i","j","updateScore","row","col","getComponent","setNumber","addBlock","push","height","block","instantiate","parent","setPosition","v2","getEmptyLocations","locations","length","location","Math","floor","random","position","number","num","string","event","keyCode","macro","KEY","right","blockMoveRight","left","blockMoveLeft","up","blockMoveUp","down","blockMoveDown","afterMove","hasMoved","checkGameOver","gameOver","moveBlock","callback","action","moveTo","finish","callFunc","runAction","sequence","combineBlock","b1","b2","destroy","scale1","scaleTo","scale2","mid","n","move","toMove","count","tween","node","to","opacity","gameWin","onRestartClick","onContinueClick"],"mappings":"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","file":"GameManagaer.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const ROWS = 4;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel: cc.Label,\n        bestScoreLabel: cc.Label,\n        blockPrefab: cc.Prefab,\n        bgBox: cc.Node,\n        cellPrefab: cc.Prefab,\n        loseLayOut: cc.Node,\n        winLayOut: cc.Node,\n        _gap: {\n            default: 10,\n            serializable: false,\n        },\n        _blockSize: null,\n        _data: [],\n        _arrBlock: [],\n        _posisions: [],\n        _score: null,\n        _canMove: true,\n    },\n\n    onLoad() {\n        this._canMove = true;\n        this.loseLayOut.active = false;\n    },\n\n    start() {\n        this._blockSize = (this.bgBox.width - this._gap * 5) / 4;\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n\n        this.blockInit();\n        this.init();\n    },\n\n    arrInit(x, y) {\n        let blockArr = new Array();\n        for (let i = 0; i < x; i++) {\n            blockArr[i] = new Array();\n            for (let j = 0; j < y; j++) {\n                blockArr[i][j] = 0;\n            }\n        }\n        return blockArr;\n    },\n\n    init() {\n        this.updateScore(0);\n        this._data = this.arrInit(ROWS, ROWS);\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(0);\n                this._data[row][col] = 0;\n            }\n        };\n        this.addBlock();\n        this.addBlock();\n    },\n\n    blockInit() {\n        this._arrBlock = this.arrInit(ROWS, ROWS);\n\n        for (let i = 0; i < ROWS; i++) {\n            this._posisions.push([0, 0, 0, 0]);\n            for (let j = 0; j < ROWS; j++) {\n                let x = -(this.bgBox.width / 2) + (this._gap * (j + 1) + this._blockSize / 2 * (2 * j + 1));\n                let y = (this.bgBox.height / 2) - (this._gap * (i + 1) + this._blockSize / 2 * (2 * i + 1));\n                let block = cc.instantiate(this.blockPrefab);\n                block.parent = this.bgBox;\n                block.width = this._blockSize;\n                block.height = this._blockSize;\n                block.setPosition(cc.v2(x, y));\n                this._posisions[i][j] = (cc.v2(x, y));\n                block.getComponent(\"BlockController\").setNumber(0);\n                this._arrBlock[i][j] = (block);\n            }\n        }\n\n    },\n\n    getEmptyLocations() {\n        let locations = [];\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                if (this._data[row][col] === 0) {\n                    locations.push({\n                        x: row,\n                        y: col,\n                    })\n                }\n            }\n        }\n        return locations;\n    },\n\n    addBlock() {\n        let locations = this.getEmptyLocations();\n        if (locations.length === 0) return false;\n\n        let location = locations[Math.floor(Math.random() * locations.length)];\n        let x = location.x;\n        let y = location.y;\n        let position = this._posisions[x][y];\n        let block = cc.instantiate(this.blockPrefab);\n        block.width = this._blockSize;\n        block.height = this._blockSize;\n        block.parent = this.bgBox;\n        block.setPosition(position);\n\n        let number = Math.random() <= 0.95 ? 2 : 4;\n        block.getComponent(\"BlockController\").setNumber(number);\n        this._arrBlock[x][y] = block;\n        this._data[x][y] = number;\n\n        return true;\n    },\n\n    updateScore(num) {\n        this._score = num;\n        this.scoreLabel.string = num;\n    },\n\n    onKeyDown(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveRight();\n                }\n                break;\n            case cc.macro.KEY.left:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveLeft();\n                }\n                break;\n            case cc.macro.KEY.up:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            case cc.macro.KEY.down:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveDown();\n\n                }\n                break;\n        }\n    },\n\n    // updateBlockNum: function () {\n    //     for (let row = 0; row < ROWS; row++) {\n    //         for (let col = 0; col < ROWS; col++) {\n    //             this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(this._data[row][col]);\n    //         }\n    //     }\n    // },\n\n    afterMove(hasMoved) {\n        this._canMove = true\n        if (hasMoved) {\n            this.updateScore(this._score + 1);\n            this.addBlock();\n        }\n        else if (this.checkGameOver()) {\n            this.gameOver()\n        }\n    },\n\n    moveBlock(block, position, callback) {\n        let action = cc.moveTo(.05, position);\n        let finish = cc.callFunc(() => {\n            callback && callback();\n        })\n        block.runAction(cc.sequence(action, finish,));\n    },\n\n    combineBlock(b1, b2, num, callback) {\n        b1.destroy();\n        let scale1 = cc.scaleTo(0.1, 1.1);\n        let scale2 = cc.scaleTo(0.1, 1);\n        let mid = cc.callFunc(() => {\n            b2.getComponent(\"BlockController\").setNumber(num);\n        });\n        let finish = cc.callFunc(() => {\n            callback && callback();\n        })\n        b2.runAction(cc.sequence(scale1, mid, scale2, finish));\n    },\n\n    checkGameOver() {\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                let n = this._data[i][j];\n                if (n === 0) return false;\n                if (j > 0 && this._data[i][j - 1] == n) return false;\n                if (j < ROWS - 1 && this._data[i][j + 1] == n) return false;\n                if (i > 0 && this._data[i - 1][j] == n) return false;\n                if (i < ROWS - 1 && this._data[i + 1][j] == n) return false;\n\n            }\n        }\n        return true;\n    },\n\n    blockMoveRight() {\n        let hasMoved = false;\n        let move = (x, y, callback) => {\n            if (y == ROWS + 1 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x][y + 1] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n                this._arrBlock[x][y + 1] = block;\n                this._data[x][y + 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x, y + 1, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x][y + 1] == this._data[x][y]) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n\n                this._data[x][y + 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, () => {\n                    this.combineBlock(block, this._arrBlock[x][y + 1], this._data[x][y + 1], () => {\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            } else {\n                callback && callback();\n                return;\n            }\n        }\n\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = ROWS - 1; j >= 0; j--) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveLeft() {\n        let hasMoved = false;\n        let move = (x, y, callback) => {\n            if (y == 0 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x][y - 1] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n                this._arrBlock[x][y - 1] = block;\n                this._data[x][y - 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x, y - 1, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x][y - 1] == this._data[x][y]) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n\n                this._data[x][y - 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, () => {\n                    this.combineBlock(block, this._arrBlock[x][y - 1], this._data[x][y - 1], () => {\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveDown() {\n        let hasMoved = false;\n        let move = (x, y, callback) => {\n            if (x == ROWS - 1 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x + 1][y] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n                this._arrBlock[x + 1][y] = block;\n                this._data[x + 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x + 1, y, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x + 1][y] == this._data[x][y]) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n\n                this._data[x + 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, () => {\n                    this.combineBlock(block, this._arrBlock[x + 1][y], this._data[x + 1][y], () => {\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = ROWS - 1; i >= 0; i--) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveUp() {\n        let hasMoved = false;\n        let move = (x, y, callback) => {\n            if (x == 0 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x - 1][y] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n                this._arrBlock[x - 1][y] = block;\n                this._data[x - 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x - 1, y, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x - 1][y] == this._data[x][y]) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n\n                this._data[x - 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, () => {\n                    this.combineBlock(block, this._arrBlock[x - 1][y], this._data[x - 1][y], () => {\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    gameOver() {\n        cc.tween(this.node)\n            .to(.5, { opacity: 150 })\n            .start()\n        this.loseLayOut.active = true;\n    },\n\n    gameWin() {\n        this._canMove = false;\n        cc.tween(this.node)\n            .to(.5, { opacity: 150 })\n            .start()\n        this.winLayOut.active = true;\n    },\n\n    onRestartClick() {\n        this._canMove = true;\n        this.blockInit();\n        this.init();\n        this.node.opacity = 255;\n        this.loseLayOut.active = false\n        this.winLayOut.active = false\n    },\n\n    onContinueClick() {\n        this._canMove = true;\n        this.node.opacity = 255;\n        this.winLayOut.active = false\n    }\n\n});\n"]}
=======
{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/GameManagaer.js"],"names":["ROWS","cc","Class","extends","Component","properties","scoreLabel","Label","bestScoreLabel","blockPrefab","Prefab","bgBox","Node","cellPrefab","loseLayOut","winLayOut","_gap","default","serializable","_blockSize","_data","_arrBlock","_posisions","_score","_canMove","onLoad","active","start","width","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","blockInit","init","arrInit","x","y","blockArr","Array","i","j","updateScore","row","col","getComponent","setNumber","addBlock","push","height","block","instantiate","parent","setPosition","v2","getEmptyLocations","locations","length","location","Math","floor","random","position","number","num","string","event","keyCode","macro","KEY","right","blockMoveRight","left","blockMoveLeft","up","blockMoveUp","down","blockMoveDown","afterMove","hasMoved","checkGameOver","gameOver","moveBlock","callback","action","moveTo","finish","callFunc","runAction","sequence","combineBlock","b1","b2","destroy","scale1","scaleTo","scale2","mid","n","move","toMove","log","count","tween","node","to","opacity","gameWin","onRestartClick","onContinueClick"],"mappings":"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","file":"GameManagaer.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const ROWS = 4;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel: cc.Label,\n        bestScoreLabel: cc.Label,\n        blockPrefab: cc.Prefab,\n        bgBox: cc.Node,\n        cellPrefab: cc.Prefab,\n        loseLayOut: cc.Node,\n        winLayOut: cc.Node,\n        _gap: {\n            default: 10,\n            serializable: false,\n        },\n        _blockSize: null,\n        _data: [],\n        _arrBlock: [],\n        _posisions: [],\n        _score: null,\n        _canMove: true,\n    },\n\n    onLoad() {\n        this._canMove = true;\n        this.loseLayOut.active = false;\n    },\n\n    start() {\n        this._blockSize = (this.bgBox.width - this._gap * 5) / 4;\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n\n        this.blockInit();\n        this.init();\n    },\n\n    arrInit(x, y) {\n        let blockArr = new Array();\n        for (let i = 0; i < x; i++) {\n            blockArr[i] = new Array();\n            for (let j = 0; j < y; j++) {\n                blockArr[i][j] = 0;\n            }\n        }\n        return blockArr;\n    },\n\n    init() {\n        this.updateScore(0);\n        this._data = this.arrInit(ROWS, ROWS);\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(0);\n                this._data[row][col] = 0;\n            }\n        };\n        this.addBlock();\n        this.addBlock();\n    },\n\n    blockInit() {\n        this._arrBlock = this.arrInit(ROWS, ROWS);\n\n        for (let i = 0; i < ROWS; i++) {\n            this._posisions.push([0, 0, 0, 0]);\n            for (let j = 0; j < ROWS; j++) {\n                let x = -(this.bgBox.width / 2) + (this._gap * (j + 1) + this._blockSize / 2 * (2 * j + 1));\n                let y = (this.bgBox.height / 2) - (this._gap * (i + 1) + this._blockSize / 2 * (2 * i + 1));\n                let block = cc.instantiate(this.blockPrefab);\n                block.parent = this.bgBox;\n                block.width = this._blockSize;\n                block.height = this._blockSize;\n                block.setPosition(cc.v2(x, y));\n                this._posisions[i][j] = (cc.v2(x, y));\n                block.getComponent(\"BlockController\").setNumber(0);\n                this._arrBlock[i][j] = (block);\n            }\n        }\n\n    },\n\n    getEmptyLocations() {\n        let locations = [];\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                if (this._data[row][col] === 0) {\n                    locations.push({\n                        x: row,\n                        y: col,\n                    })\n                }\n            }\n        }\n        return locations;\n    },\n\n    addBlock() {\n        let locations = this.getEmptyLocations();\n        if (locations.length === 0) return false;\n\n        let location = locations[Math.floor(Math.random() * locations.length)];\n        let x = location.x;\n        let y = location.y;\n        let position = this._posisions[x][y];\n        let block = cc.instantiate(this.blockPrefab);\n        block.width = this._blockSize;\n        block.height = this._blockSize;\n        block.parent = this.bgBox;\n        block.setPosition(position);\n\n        let number = Math.random() <= 0.95 ? 2 : 4;\n        block.getComponent(\"BlockController\").setNumber(number);\n        this._arrBlock[x][y] = block;\n        this._data[x][y] = number;\n\n        return true;\n    },\n\n    updateScore(num) {\n        this._score = num;\n        this.scoreLabel.string = num;\n    },\n\n    onKeyDown(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveRight();\n                }\n                break;\n            case cc.macro.KEY.left:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveLeft();\n                }\n                break;\n            case cc.macro.KEY.up:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            case cc.macro.KEY.down:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveDown();\n\n                }\n                break;\n        }\n    },\n\n    afterMove(hasMoved) {\n        this._canMove = true\n        if (hasMoved) {\n            this.updateScore(this._score + 1);\n            this.addBlock();\n        }\n        else if (this.checkGameOver()) {\n            this.gameOver()\n        }\n    },\n\n    moveBlock(block, position, callback) {\n        let action = cc.moveTo(.05, position);\n        let finish = cc.callFunc(() => {\n            callback && callback();\n        })\n        block.runAction(cc.sequence(action, finish,));\n    },\n\n    combineBlock(b1, b2, num, callback) {\n        b1.destroy();\n        let scale1 = cc.scaleTo(0.1, 1.1);\n        let scale2 = cc.scaleTo(0.1, 1);\n        let mid = cc.callFunc(() => {\n            b2.getComponent(\"BlockController\").setNumber(num);\n        });\n        let finish = cc.callFunc(() => {\n            callback && callback();\n        })\n        b2.runAction(cc.sequence(scale1, mid, scale2, finish));\n    },\n\n    checkGameOver() {\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                let n = this._data[i][j];\n                if (n === 0) return false;\n                if (j > 0 && this._data[i][j - 1] == n) return false;\n                if (j < ROWS - 1 && this._data[i][j + 1] == n) return false;\n                if (i > 0 && this._data[i - 1][j] == n) return false;\n                if (i < ROWS - 1 && this._data[i + 1][j] == n) return false;\n\n            }\n        }\n        return true;\n    },\n\n    blockMoveRight() {\n        let hasMoved = false;\n        let move = (x, y, callback) => {\n            if (y == ROWS + 1 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x][y + 1] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n                this._arrBlock[x][y + 1] = block;\n                this._data[x][y + 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x, y + 1, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x][y + 1] == this._data[x][y]) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n                this._data[x][y + 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, () => {\n                    this.combineBlock(block, this._arrBlock[x][y + 1], this._data[x][y + 1], () => {\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            } else {\n                callback && callback();\n                return;\n            }\n        }\n\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = ROWS - 1; j >= 0; j--) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n        cc.log(toMove)\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveLeft() {\n        let hasMoved = false;\n        let move = (x, y, callback) => {\n            if (y == 0 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x][y - 1] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n                this._arrBlock[x][y - 1] = block;\n                this._data[x][y - 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x, y - 1, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x][y - 1] == this._data[x][y]) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n\n                this._data[x][y - 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, () => {\n                    this.combineBlock(block, this._arrBlock[x][y - 1], this._data[x][y - 1], () => {\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveDown() {\n        let hasMoved = false;\n        let move = (x, y, callback) => {\n            if (x == ROWS - 1 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x + 1][y] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n                this._arrBlock[x + 1][y] = block;\n                this._data[x + 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x + 1, y, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x + 1][y] == this._data[x][y]) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n\n                this._data[x + 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, () => {\n                    this.combineBlock(block, this._arrBlock[x + 1][y], this._data[x + 1][y], () => {\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = ROWS - 1; i >= 0; i--) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveUp() {\n        let hasMoved = false;\n        let move = (x, y, callback) => {\n            if (x == 0 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x - 1][y] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n                this._arrBlock[x - 1][y] = block;\n                this._data[x - 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x - 1, y, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x - 1][y] == this._data[x][y]) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n\n                this._data[x - 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, () => {\n                    this.combineBlock(block, this._arrBlock[x - 1][y], this._data[x - 1][y], () => {\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    gameOver() {\n        cc.tween(this.node)\n            .to(.5, { opacity: 150 })\n            .start()\n        this.loseLayOut.active = true;\n    },\n\n    gameWin() {\n        this._canMove = false;\n        cc.tween(this.node)\n            .to(.5, { opacity: 150 })\n            .start()\n        this.winLayOut.active = true;\n    },\n\n    onRestartClick() {\n        this._canMove = true;\n        this.blockInit();\n        this.init();\n        this.node.opacity = 255;\n        this.loseLayOut.active = false\n        this.winLayOut.active = false\n    },\n\n    onContinueClick() {\n        this._canMove = true;\n        this.node.opacity = 255;\n        this.winLayOut.active = false\n    }\n\n});\n"]}
>>>>>>> Stashed changes
