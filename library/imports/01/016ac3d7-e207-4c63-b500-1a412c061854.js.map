{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/GameManager.js"],"names":["ROWS","DIRECTION","cc","Enum","RIGHT","LEFT","UP","DOWN","MIN_LENGTH","Class","extends","Component","properties","scoreLabel","Label","bestScoreLabel","blockPrefab","Prefab","bgBox","Node","cellPrefab","loseLayOut","winLayOut","_gap","default","serializable","_blockSize","_data","_arrBlock","_posisions","_score","_canMove","_startPoint","_endPoint","_firstX","_firstY","_endX","_endY","_vector","onLoad","active","_isTouch","_isCLick","start","width","eventHandler","getScoreStorge","blockInit","init","arrInit","x","y","blockArr","Array","i","j","updateScore","row","col","getComponent","setNumber","addBlock","push","height","block","instantiate","parent","setPosition","v2","getEmptyLocations","locations","length","location","Math","floor","random","position","number","num","string","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","sys","isMobile","event","getLocation","reflectTouch","IPAD","DESKTOP_BROWSER","mouseEvent","startVec","endVec","pointsVec","sub","vecLength","mag","abs","touchEvent","keyCode","macro","KEY","right","blockMoveRight","left","blockMoveLeft","up","blockMoveUp","down","blockMoveDown","direction","log","afterMove","hasMoved","checkScore","checkGameOver","gameOver","moveBlock","callback","action","moveTo","finish","callFunc","runAction","sequence","combineBlock","b1","b2","destroy","scale1","scaleTo","scale2","mid","n","move","toMove","count","tween","node","to","opacity","gameWin","onRestartClick","onContinueClick","scoreStorge","localStorage","getItem","JSON","parse","newScore","parseInt","setItem","stringify"],"mappings":"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","file":"GameManager.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const ROWS = 4;\nconst DIRECTION = cc.Enum({\n    RIGHT: -1,\n    LEFT: -1,\n    UP: -1,\n    DOWN: -1\n});\nconst MIN_LENGTH = 100;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel : cc.Label,\n        bestScoreLabel : cc.Label,\n        blockPrefab : cc.Prefab,\n        bgBox : cc.Node,\n        cellPrefab : cc.Prefab,\n        loseLayOut: cc.Node,\n        winLayOut: cc.Node,\n\n        _gap :{\n            default : 10,\n            serializable : false,\n        },\n        _blockSize : null,\n        _data: [],\n        _arrBlock : [],\n        _posisions : [],\n        _score : null,\n        _canMove : true,\n        _startPoint : null,\n        _endPoint : null,\n        _firstX : null,\n        _firstY : null,\n        _endX : null,\n        _endY : null,\n        _vector : null,\n    },\n\n    onLoad(){\n        this._canMove = true;\n        this.loseLayOut.active = false;\n        this._isTouch = true;\n        this._isCLick = true;\n    },\n    \n    start () {\n        this._blockSize = (this.bgBox.width - this._gap * 5) / 4;\n       \n        this.eventHandler();\n        this.getScoreStorge();\n        this.blockInit();\n        this.init();\n    },\n\n    arrInit(x, y){\n        let blockArr = new Array();\n        for (let i = 0; i < x; i++) {\n            blockArr[i] = new Array();\n            for (let j = 0; j < y; j++) {\n                blockArr[i][j] = 0;\n            }\n        }\n        return blockArr;\n    },\n\n    init(){\n        this.updateScore(0);\n        this._data = this. arrInit(ROWS, ROWS);\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(0);    \n                this._data[row][col] = 0;            \n            }\n        };   \n        this.addBlock();\n        this.addBlock();\n    },\n\n    blockInit(){\n        this._arrBlock = this.arrInit(ROWS, ROWS);\n\n        for(let i = 0; i < ROWS; i++){\n            this._posisions.push([0,0,0,0]);\n            for(let j = 0; j < ROWS; j++){\n                let x = -(this.bgBox.width / 2) + (this._gap * (j + 1) + this._blockSize / 2 * (2 * j + 1));\n                let y = (this.bgBox.height / 2) - (this._gap * (i + 1) + this._blockSize / 2 * (2 * i + 1));\n                let block = cc.instantiate(this.blockPrefab);\n                block.parent = this.bgBox;\n                block.width = this._blockSize;\n                block.height = this._blockSize;\n                block.setPosition(cc.v2(x, y));\n                this._posisions[i][j] = (cc.v2(x, y));\n                block.getComponent(\"BlockController\").setNumber(0);\n                this._arrBlock[i][j] = (block);\n            }\n        }\n       \n    },\n\n    getEmptyLocations(){\n        let locations = [];\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                if(this._data[row][col] === 0){\n                    locations.push({\n                        x : row,\n                        y : col,\n                    })\n                }                \n            }\n        }\n        return locations;\n    },\n\n    addBlock(){\n        let locations = this.getEmptyLocations();\n        if(locations.length === 0) return false;\n\n        let location = locations[Math.floor(Math.random() * locations.length)];\n        let x = location.x;\n        let y = location.y;\n        let position = this._posisions[x][y];\n        let block = cc.instantiate(this.blockPrefab);\n        block.width = this._blockSize;\n        block.height = this._blockSize;\n        block.parent = this.bgBox;\n        block.setPosition(position);\n        \n        let number = Math.random() <= 0.95 ? 2 : 4;\n        block.getComponent(\"BlockController\").setNumber(number);\n        this._arrBlock[x][y] = block;\n        this._data[x][y] = number;\n\n        return true;\n    },\n\n    updateScore(num){\n        this._score = num;\n        this.scoreLabel.string = num;\n    },\n\n    eventHandler(){\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n\n        if(cc.sys.isMobile){\n            this.bgBox.on(\"touchstart\", (event)=>{\n                this._startPoint = event.getLocation();\n            })\n            this.bgBox.on(\"touchend\", (event) =>{\n                this._endPoint = event.getLocation();\n                this.reflectTouch();\n            })\n            this.bgBox.on(\"touchcancel\", (event) =>{\n                this._endPoint = event.getLocation();\n                this.reflectTouch();\n            })\n        }\n        if(cc.sys.IPAD || cc.sys.DESKTOP_BROWSER){\n            this.bgBox.on(\"mousedown\", (event) =>{\n                this._startPoint = event.getLocation();\n                this._firstX = this._startPoint.x;\n                this._firstY = this._startPoint.y;\n            })\n            this.bgBox.on(\"mouseup\", (event) =>{\n                this._endPoint = event.getLocation();\n                this._endX = this._startPoint.x - this._endPoint.x;\n                this._endY = this._startPoint.y - this._endPoint.y;\n                this._vector = cc.v2(this._endX, this._endY);\n                this.mouseEvent();\n            })\n        }\n    },\n\n    reflectTouch(){\n        let startVec = this._startPoint;\n        let endVec = this._endPoint;\n        let pointsVec = endVec.sub(startVec);\n        let vecLength = pointsVec.mag();\n        if(vecLength > MIN_LENGTH){\n            if(Math.abs(pointsVec.x) > Math.abs(pointsVec.y)) {\n                if(pointsVec.x > 0) this.touchEvent(DIRECTION.RIGHT);\n                else this.touchEvent(DIRECTION.LEFT);\n            }else{\n                if(pointsVec.y > 0) this.touchEvent(DIRECTION.UP);\n                else this.touchEvent(DIRECTION.DOWN);\n            }\n        }\n    },\n\n    onKeyDown(event){\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveRight();\n                }\n                break;\n            case cc.macro.KEY.left:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveLeft();\n                }\n                \n                break;\n            case cc.macro.KEY.up:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            case cc.macro.KEY.down:\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveDown();\n                }\n                break;\n        };\n       \n    },\n\n    touchEvent(direction){\n        switch(direction){\n            case DIRECTION.RIGHT: {\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveRight();\n                }\n                break;\n            }\n            case DIRECTION.LEFT: {\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveLeft();\n                }\n                break;\n            }\n            case DIRECTION.UP: {\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            }\n            case DIRECTION.DOWN: {\n                if(this._canMove){\n                    this._canMove = false\n                    this.blockMoveDown();\n                }\n                break;\n            }\n        }\n    },\n\n    mouseEvent(){\n        if(this._vector.mag() > MIN_LENGTH){\n            cc.log(this._vector.mag())\n            if(this._vector.x < 0 && this._vector.y < 50 && this._vector.y > -50){\n                this._canMove = false\n                this.blockMoveRight();\n            }else if(this._vector.x > 0 && this._vector.y < 50 && this._vector.y > -50){\n                this._canMove = false\n                this.blockMoveLeft();\n            }\n        }else{\n            cc.log(this._vector.mag())\n            if(this._vector.y < 0 && this._vector.x < 50 && this._vector.x > -50){\n                this._canMove = false\n                this.blockMoveUp();\n            }else if(this._vector.y > 0 && this._vector.x < 50 && this._vector.x > -50){\n                this._canMove = false\n                this.blockMoveDown();\n            }\n        }\n    },\n\n    afterMove(hasMoved){\n        this._canMove = true\n        if(hasMoved){\n            this.updateScore(this._score + 1);\n            this.addBlock();\n            this.checkScore();\n        }\n        else if(this.checkGameOver()){\n            this.gameOver()\n        }\n    },\n\n    moveBlock(block, position, callback){\n        let action = cc.moveTo(.05, position);\n        let finish = cc.callFunc(()=>{\n            callback && callback();\n        })\n        block.runAction(cc.sequence(action, finish,));\n    },\n\n    combineBlock(b1, b2, num, callback){\n        b1.destroy();\n        let scale1 = cc.scaleTo(0.1, 1.1);\n        let scale2 = cc.scaleTo(0.1, 1);\n        let mid = cc.callFunc(()=>{\n            b2.getComponent(\"BlockController\").setNumber(num);\n        });\n        let finish = cc.callFunc(()=>{\n            callback && callback();\n        })\n        b2.runAction(cc.sequence(scale1, mid, scale2, finish));\n    },\n\n    checkGameOver(){  \n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                let n = this._data[i][j];\n                if(n === 0) return false;\n                if(j > 0 && this._data[i][j - 1] == n) return false;\n                if(j < ROWS - 1 && this._data[i][j + 1] == n) return false;\n                if(i > 0 && this._data[i - 1][j] == n) return false;\n                if(i < ROWS - 1 && this._data[i + 1][j] == n) return false; \n                \n            }       \n        }\n        return true;\n    },\n\n    blockMoveRight(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(y == ROWS + 1 || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x][y + 1] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n                this._arrBlock[x][y + 1] = block;\n                this._data[x][y + 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x, y + 1, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x][y + 1] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n               \n                this._data[x][y + 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x][y + 1], this._data[x][y + 1],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        \n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = ROWS - 1; j >= 0; j--){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveLeft(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(y == 0 || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x][y - 1] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n                this._arrBlock[x][y - 1] = block;\n                this._data[x][y - 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x, y - 1, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x][y - 1] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n               \n                this._data[x][y - 1] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x][y - 1], this._data[x][y - 1],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveDown(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(x == ROWS - 1  || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x + 1][y] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n                this._arrBlock[x + 1][y] = block;\n                this._data[x + 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x + 1, y, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x + 1][y] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n               \n                this._data[x + 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x + 1][y], this._data[x + 1][y],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = ROWS - 1; i >= 0; i--) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveUp(){\n        let hasMoved = false;\n        let move = (x ,y ,callback) =>{\n            if(x == 0  || this._data[x][y] == 0){\n                callback && callback();\n                return;\n            }else if(this._data[x - 1][y] == 0){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n                this._arrBlock[x - 1][y] = block;\n                this._data[x - 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, ()=>{\n                    move(x - 1, y, callback);\n                });\n                hasMoved = true;\n            }else if(this._data[x - 1][y] == this._data[x][y]){\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n               \n                this._data[x - 1][y] *= 2;\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null\n                this.moveBlock(block, position, ()=>{\n                    this.combineBlock(block, this._arrBlock[x - 1][y], this._data[x - 1][y],()=>{\n                        callback && callback();\n                    })\n                });\n                hasMoved = true;\n            }else{\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++){\n                if(this._data[i][j] != 0){\n                    toMove.push({\n                        x : i,\n                        y : j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, ()=>{\n                count ++;\n                if(count == toMove.length){\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    gameOver(){\n        cc.tween(this.node)\n            .to(.5,{opacity:150})\n            .start()\n        this.loseLayOut.active = true;\n    },\n\n    gameWin(){\n        this._canMove = false;\n        cc.tween(this.node)\n            .to(.5,{opacity:150})\n            .start()\n        this.winLayOut.active = true;\n    },\n\n    onRestartClick(){\n        this._canMove = true;\n        this.blockInit();\n        this.init();\n        this.node.opacity = 255;\n        this.loseLayOut.active = false\n        this.winLayOut.active = false\n    },\n\n    onContinueClick(){\n        this._canMove = true;\n        this.node.opacity = 255;\n        this.winLayOut.active = false\n    },\n\n    getScoreStorge(){\n        let scoreStorge = cc.sys.localStorage.getItem('bestScore');\n        if(scoreStorge !== null){\n            this.bestScoreLabel.string = JSON.parse(scoreStorge);\n        }else{\n            this.bestScoreLabel.string = 0;\n        }\n    },\n\n    checkScore(){\n        let newScore = parseInt(this.scoreLabel.string);\n        if(newScore > this.bestScoreLabel.string){\n            cc.sys.localStorage.setItem('bestScore', JSON.stringify(newScore));\n            this.bestScoreLabel.string = newScore;\n        }\n    },\n\n});\n"]}