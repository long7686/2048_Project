{"version":3,"sources":["../../../../assets/Scripts/assets/Scripts/GameManager.js"],"names":["colors","require","ROWS","DIRECTION","cc","Enum","RIGHT","LEFT","UP","DOWN","MIN_LENGTH","Class","extends","Component","properties","scoreLabel","Label","bestScoreLabel","blockPrefab","Prefab","bgBox","Node","cellPrefab","loseLayOut","winLayOut","_gap","default","serializable","_blockSize","_data","_arrBlock","_posisions","_score","_canMove","_startPoint","_endPoint","_firstX","_firstY","_endX","_endY","_vector","_first2048","onLoad","active","_isTouch","_isCLick","start","width","eventHandler","getScoreStorge","blockInit","init","arrInit","x","y","blockArr","Array","i","j","updateScore","row","col","getComponent","setNumber","addBlock","push","height","block","instantiate","parent","setPosition","v2","getEmptyLocations","locations","length","location","Math","floor","random","position","number","num","string","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDown","sys","isMobile","event","getLocation","reflectTouch","IPAD","DESKTOP_BROWSER","mouseEvent","startVec","endVec","pointsVec","sub","vecLength","mag","abs","touchEvent","keyCode","macro","KEY","right","blockMoveRight","left","blockMoveLeft","up","blockMoveUp","down","blockMoveDown","direction","afterMove","hasMoved","checkScore","checkGameOver","gameOver","moveBlock","callback","action","moveTo","finish","callFunc","runAction","sequence","combineBlock","b1","b2","destroy","scale1","scaleTo","scale2","mid","gameWin","activeCombine","_canCombine","n","move","toMove","count","tween","node","to","opacity","onRestartClick","onContinueClick","scoreStorge","localStorage","getItem","JSON","parse","newScore","parseInt","setItem","stringify"],"mappings":"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","file":"GameManager.js","sourceRoot":"../../../../assets/Scripts","sourcesContent":["const colors = require(\"./Colors\");\n\nconst ROWS = 4;\nconst DIRECTION = cc.Enum({\n    RIGHT: -1,\n    LEFT: -1,\n    UP: -1,\n    DOWN: -1\n});\nconst MIN_LENGTH = 10;\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scoreLabel: cc.Label,\n        bestScoreLabel: cc.Label,\n        blockPrefab: cc.Prefab,\n        bgBox: cc.Node,\n        cellPrefab: cc.Prefab,\n        loseLayOut: cc.Node,\n        winLayOut: cc.Node,\n\n        _gap: {\n            default: 10,\n            serializable: false,\n        },\n        _blockSize: null,\n        _data: [],\n        _arrBlock: [],\n        _posisions: [],\n        _score: null,\n        _canMove: true,\n        _startPoint: null,\n        _endPoint: null,\n        _firstX: null,\n        _firstY: null,\n        _endX: null,\n        _endY: null,\n        _vector: null,\n        _first2048: true\n    },\n\n    onLoad() {\n        this._canMove = true;\n        this.loseLayOut.active = false;\n        this._isTouch = true;\n        this._isCLick = true;\n        this._first2048 = true;\n    },\n\n    start() {\n        this._blockSize = (this.bgBox.width - this._gap * 5) / 4;\n\n        this.eventHandler();\n        this.getScoreStorge();\n        this.blockInit();\n        this.init();\n    },\n\n    arrInit(x, y) {\n        let blockArr = new Array();\n        for (let i = 0; i < x; i++) {\n            blockArr[i] = new Array();\n            for (let j = 0; j < y; j++) {\n                blockArr[i][j] = 0;\n            }\n        }\n        return blockArr;\n    },\n\n    init() {\n        this.updateScore(0);\n        this._data = this.arrInit(ROWS, ROWS);\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                this._arrBlock[row][col].getComponent(\"BlockController\").setNumber(0);\n                this._data[row][col] = 0;\n            }\n        };\n        this.addBlock();\n        this.addBlock();\n    },\n\n    blockInit() {\n        this._arrBlock = this.arrInit(ROWS, ROWS);\n\n        for (let i = 0; i < ROWS; i++) {\n            this._posisions.push([0, 0, 0, 0]);\n            for (let j = 0; j < ROWS; j++) {\n                let x = -(this.bgBox.width / 2) + (this._gap * (j + 1) + this._blockSize / 2 * (2 * j + 1));\n                let y = (this.bgBox.height / 2) - (this._gap * (i + 1) + this._blockSize / 2 * (2 * i + 1));\n                let block = cc.instantiate(this.blockPrefab);\n                block.parent = this.bgBox;\n                block.width = this._blockSize;\n                block.height = this._blockSize;\n                block.setPosition(cc.v2(x, y));\n                this._posisions[i][j] = (cc.v2(x, y));\n                block.getComponent(\"BlockController\").setNumber(0);\n                this._arrBlock[i][j] = (block);\n            }\n        }\n\n    },\n\n    getEmptyLocations() {\n        let locations = [];\n        for (let row = 0; row < ROWS; row++) {\n            for (let col = 0; col < ROWS; col++) {\n                if (this._data[row][col] === 0) {\n                    locations.push({\n                        x: row,\n                        y: col,\n                    })\n                }\n            }\n        }\n        return locations;\n    },\n\n    addBlock() {\n        let locations = this.getEmptyLocations();\n        if (locations.length === 0) return false;\n\n        let location = locations[Math.floor(Math.random() * locations.length)];\n        let x = location.x;\n        let y = location.y;\n        let position = this._posisions[x][y];\n        let block = cc.instantiate(this.blockPrefab);\n        block.width = this._blockSize;\n        block.height = this._blockSize;\n        block.parent = this.bgBox;\n        block.setPosition(position);\n\n        let number = Math.random() <= 0.9 ? 2 : 4;\n        block.getComponent(\"BlockController\").setNumber(number);\n        this._arrBlock[x][y] = block;\n        this._data[x][y] = number;\n\n        return true;\n    },\n\n    updateScore(num) {\n        this._score = num;\n        this.scoreLabel.string = num;\n    },\n\n    eventHandler() {\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\n        \n        if (cc.sys.isMobile) {\n            this.bgBox.on(\"touchstart\", (event) => {\n                this._startPoint = event.getLocation();\n            })\n            this.bgBox.on(\"touchend\", (event) => {\n                this._endPoint = event.getLocation();\n                this.reflectTouch();\n            })\n            this.bgBox.on(\"touchcancel\", (event) => {\n                this._endPoint = event.getLocation();\n                this.reflectTouch();\n            })\n        }\n        if (cc.sys.IPAD || cc.sys.DESKTOP_BROWSER) {\n            this.bgBox.on(\"mousedown\", (event) => {\n                this._startPoint = event.getLocation();\n                this._firstX = this._startPoint.x;\n                this._firstY = this._startPoint.y;\n            })\n            this.bgBox.on(\"mouseup\", (event) => {\n                this._endPoint = event.getLocation();\n                this._endX = this._startPoint.x - this._endPoint.x;\n                this._endY = this._startPoint.y - this._endPoint.y;\n                this._vector = cc.v2(this._endX, this._endY);\n                this.mouseEvent();\n            })\n        }\n    },\n\n    reflectTouch() {\n        let startVec = this._startPoint;\n        let endVec = this._endPoint;\n        let pointsVec = endVec.sub(startVec);\n        let vecLength = pointsVec.mag();\n        if (vecLength > MIN_LENGTH) {\n            if (Math.abs(pointsVec.x) > Math.abs(pointsVec.y)) {\n                if (pointsVec.x > 0) this.touchEvent(DIRECTION.RIGHT);\n                else this.touchEvent(DIRECTION.LEFT);\n            } else {\n                if (pointsVec.y > 0) this.touchEvent(DIRECTION.UP);\n                else this.touchEvent(DIRECTION.DOWN);\n            }\n        }\n    },\n\n    onKeyDown(event) {\n        switch (event.keyCode) {\n            case cc.macro.KEY.right:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveRight();\n                }\n                break;\n            case cc.macro.KEY.left:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveLeft();\n                }\n\n                break;\n            case cc.macro.KEY.up:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            case cc.macro.KEY.down:\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveDown();\n                }\n                break;\n        };\n\n    },\n\n    touchEvent(direction) {\n        switch (direction) {\n            case DIRECTION.RIGHT: {\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveRight();\n                }\n                break;\n            }\n            case DIRECTION.LEFT: {\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveLeft();\n                }\n                break;\n            }\n            case DIRECTION.UP: {\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveUp();\n                }\n                break;\n            }\n            case DIRECTION.DOWN: {\n                if (this._canMove) {\n                    this._canMove = false\n                    this.blockMoveDown();\n                }\n                break;\n            }\n        }\n    },\n\n    mouseEvent() {\n        if (this._vector.mag() > MIN_LENGTH) {\n            if (this._canMove){\n                this._canMove = false;\n                if (this._vector.x < 0 && this._vector.y < 50 && this._vector.y > -50) {\n                    this.blockMoveRight();\n                } else if (this._vector.x > 0 && this._vector.y < 50 && this._vector.y > -50) {\n                    this.blockMoveLeft();\n                }\n                else if (this._vector.y < 0 && this._vector.x < 50 && this._vector.x > -50) {\n                    this.blockMoveUp();\n                }\n                else if (this._vector.y > 0 && this._vector.x < 50 && this._vector.x > -50) {\n                    this.blockMoveDown();\n                }\n            }\n            \n        }\n    },\n\n    afterMove(hasMoved) {\n        this._canMove = true\n        if(this.winLayOut.active || this.loseLayOut.active)  this._canMove = false;\n        if (hasMoved) {\n            this.updateScore(this._score + 1);\n            this.addBlock();\n            this.checkScore();\n        }\n        else if (this.checkGameOver()) {\n            this.gameOver()\n        }\n    },\n\n    moveBlock(block, position, callback) {\n        let action = cc.moveTo(.05, position);\n        let finish = cc.callFunc(() => {\n            callback && callback();\n        })\n        block.runAction(cc.sequence(action, finish,));\n    },\n\n    combineBlock(b1, b2, num, callback) {\n        b1.destroy();\n        let scale1 = cc.scaleTo(0.1, 1.1);\n        let scale2 = cc.scaleTo(0.1, 1);\n        let mid = cc.callFunc(() => {\n            b2.getComponent(\"BlockController\").setNumber(num);\n        });\n        let finish = cc.callFunc(() => {\n            callback && callback();\n        })\n        b2.runAction(cc.sequence(scale1, mid, scale2, finish));\n        if(this._first2048){\n            if(num === 2048){\n                this.gameWin()\n                this._first2048 = false;\n            } \n        }\n    },\n\n    activeCombine(){\n        for(let i = 0; i < ROWS; i++){\n            for(let j = 0; j<ROWS; j++){\n                if (this._data[i][j] !== 0){\n                    this._arrBlock[i][j].getComponent(\"BlockController\")._canCombine = true;\n                }\n            }\n        }\n    },\n\n    checkGameOver() {\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                let n = this._data[i][j];\n                if (n === 0) return false;\n                if (j > 0 && this._data[i][j - 1] == n) return false;\n                if (j < ROWS - 1 && this._data[i][j + 1] == n) return false;\n                if (i > 0 && this._data[i - 1][j] == n) return false;\n                if (i < ROWS - 1 && this._data[i + 1][j] == n) return false;\n                \n            }\n        }\n        return true;\n    },\n\n    blockMoveRight() {\n        let hasMoved = false;\n        this.activeCombine()\n        let move = (x, y, callback) => {\n            if (y == ROWS + 1 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x][y + 1] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y + 1];\n                this._arrBlock[x][y + 1] = block;\n                this._data[x][y + 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x, y + 1, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x][y + 1] == this._data[x][y]) {\n                if (this._arrBlock[x][y+1].getComponent(\"BlockController\")._canCombine){\n                    this._arrBlock[x][y+1].getComponent(\"BlockController\")._canCombine = false;\n                    let block = this._arrBlock[x][y];\n                    let position = this._posisions[x][y + 1];\n                    this._data[x][y + 1] *= 2;\n                    this._data[x][y] = 0;\n                    this._arrBlock[x][y] = null\n                    this.moveBlock(block, position, () => {\n                        this.combineBlock(block, this._arrBlock[x][y + 1], this._data[x][y + 1], () => {\n                            callback && callback();\n                        })\n                    });\n                    hasMoved = true;\n                }\n                \n            } else {\n                callback && callback();\n                return;\n            }\n        }\n\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = ROWS - 1; j >= 0; j--) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveLeft() {\n        let hasMoved = false;\n        this.activeCombine()\n        let move = (x, y, callback) => {\n            if (y == 0 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x][y - 1] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x][y - 1];\n                this._arrBlock[x][y - 1] = block;\n                this._data[x][y - 1] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x, y - 1, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x][y - 1] == this._data[x][y]) {\n                if (this._arrBlock[x][y-1].getComponent(\"BlockController\")._canCombine){\n                    this._arrBlock[x][y-1].getComponent(\"BlockController\")._canCombine = false\n                    let block = this._arrBlock[x][y];\n                    let position = this._posisions[x][y - 1];\n    \n                    this._data[x][y - 1] *= 2;\n                    this._data[x][y] = 0;\n                    this._arrBlock[x][y] = null\n                    this.moveBlock(block, position, () => {\n                        this.combineBlock(block, this._arrBlock[x][y - 1], this._data[x][y - 1], () => {\n                            callback && callback();\n                        })\n                    });\n                    hasMoved = true;\n                }\n                \n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count === toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveDown() {\n        let hasMoved = false;\n        this.activeCombine()\n        let move = (x, y, callback) => {\n            if (x == ROWS - 1 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x + 1][y] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x + 1][y];\n                this._arrBlock[x + 1][y] = block;\n                this._data[x + 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x + 1, y, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x + 1][y] == this._data[x][y]) {\n                if(this._arrBlock[x + 1][y].getComponent(\"BlockController\")._canCombine){\n                    this._arrBlock[x + 1][y].getComponent(\"BlockController\")._canCombine = false;\n                    let block = this._arrBlock[x][y];\n                    let position = this._posisions[x + 1][y];\n                    this._data[x + 1][y] *= 2;\n                    this._data[x][y] = 0;\n                    this._arrBlock[x][y] = null\n                    this.moveBlock(block, position, () => {\n                        this.combineBlock(block, this._arrBlock[x + 1][y], this._data[x + 1][y], () => {\n                            callback && callback();\n                        })\n                    });\n                    hasMoved = true;\n                }\n                \n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = ROWS - 1; i >= 0; i--) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    blockMoveUp() {\n        let hasMoved = false;\n        this.activeCombine()\n        let move = (x, y, callback) => {\n            if (x == 0 || this._data[x][y] == 0) {\n                callback && callback();\n                return;\n            } else if (this._data[x - 1][y] == 0) {\n                let block = this._arrBlock[x][y];\n                let position = this._posisions[x - 1][y];\n                this._arrBlock[x - 1][y] = block;\n                this._data[x - 1][y] = this._data[x][y];\n                this._data[x][y] = 0;\n                this._arrBlock[x][y] = null;\n                this.moveBlock(block, position, () => {\n                    move(x - 1, y, callback);\n                });\n                hasMoved = true;\n            } else if (this._data[x - 1][y] == this._data[x][y]) {\n                if(this._arrBlock[x - 1][y].getComponent(\"BlockController\")._canCombine){\n                    this._arrBlock[x - 1][y].getComponent(\"BlockController\")._canCombine = false;\n                    let block = this._arrBlock[x][y];\n                    let position = this._posisions[x - 1][y];\n    \n                    this._data[x - 1][y] *= 2;\n                    this._data[x][y] = 0;\n                    this._arrBlock[x][y] = null\n                    this.moveBlock(block, position, () => {\n                        this.combineBlock(block, this._arrBlock[x - 1][y], this._data[x - 1][y], () => {\n                            callback && callback();\n                        })\n                    });\n                    hasMoved = true;    \n                }\n                \n            } else {\n                callback && callback();\n                return;\n            }\n        }\n        let toMove = [];\n        for (let i = 0; i < ROWS; i++) {\n            for (let j = 0; j < ROWS; j++) {\n                if (this._data[i][j] != 0) {\n                    toMove.push({\n                        x: i,\n                        y: j,\n                    });\n                }\n            }\n        }\n        let count = 0;\n        for (let i = 0; i < toMove.length; i++) {\n            move(toMove[i].x, toMove[i].y, () => {\n                count++;\n                if (count == toMove.length) {\n                    this.afterMove(hasMoved);\n                }\n            })\n        }\n    },\n\n    gameOver() {\n        cc.tween(this.node)\n            .to(.5, { opacity: 150 })\n            .start()\n        this.loseLayOut.active = true;\n    },\n\n    gameWin() {\n        cc.tween(this.node)\n            .to(1, { opacity: 150 })\n            .start()\n        this.winLayOut.active = true;\n    },\n\n    onRestartClick() {\n        this._canMove = true;\n        this.blockInit();\n        this.init();\n        this.node.opacity = 255;\n        this.loseLayOut.active = false\n        this.winLayOut.active = false\n    },\n\n    onContinueClick() {\n        this._canMove = true;\n        this.node.opacity = 255;\n        this.winLayOut.active = false\n    },\n\n    getScoreStorge() {\n        let scoreStorge = cc.sys.localStorage.getItem('bestScore');\n        if (scoreStorge !== null) {\n            this.bestScoreLabel.string = JSON.parse(scoreStorge);\n        } else {\n            this.bestScoreLabel.string = 0;\n        }\n    },\n\n    checkScore() {\n        let newScore = parseInt(this.scoreLabel.string);\n        if (newScore > this.bestScoreLabel.string) {\n            cc.sys.localStorage.setItem('bestScore', JSON.stringify(newScore));\n            this.bestScoreLabel.string = newScore;\n        }\n    },\n\n});\n"]}